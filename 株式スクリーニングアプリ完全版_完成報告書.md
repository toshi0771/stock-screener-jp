# 株式スクリーニングWebアプリケーション - 完全版 完成報告書

**作成日時**: 2025年10月18日 08:18  
**バージョン**: 3.0.0 (完全統合版)  
**ステータス**: ✅ 正常稼働中

---

## 🎉 完成した機能

### 1. Webアプリケーション

**アクセスURL**: https://5000-itvw29tdrpzjiu2zgj2pg-79c9481d.manusvm.computer

**主な機能**:
- ✅ パーフェクトオーダースクリーニング
- ✅ ボリンジャーバンド±3σスクリーニング
- ✅ 52週新高値押し目スクリーニング
- ✅ 市場フィルター（プライム・スタンダード・グロース）
- ✅ EMAタッチフィルター（10EMA・20EMA・50EMA）
- ✅ ストキャスティクス売られすぎフィルター
- ✅ リアルタイム検索結果表示
- ✅ レスポンシブデザイン

### 2. バックエンドモジュール

**実装済みモジュール**:
- `week52_high_detector.py` - 52週新高値検出エンジン
- `ema_touch_detector.py` - EMAタッチ判定エンジン
- `stochastic_detector.py` - ストキャスティクス計算エンジン
- `pullback_screener.py` - 統合スクリーニングエンジン
- `app_enhanced.py` - Flask Webアプリケーション
- `daily_data_collection.py` - 日次データ収集スクリプト（Supabase連携）

### 3. データベース連携

**Supabase統合**:
- ✅ 前回のプロジェクトに接続済み
- ✅ スクリーニング結果の自動保存
- ✅ 検出銘柄の詳細データ保存
- ✅ ローカルバックアップとの二重保存

---

## 📊 システム構成

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────┐
│                   Webブラウザ                             │
│              (ユーザーインターフェース)                    │
└─────────────────────────────────────────────────────────┘
                          ↓ HTTP
┌─────────────────────────────────────────────────────────┐
│              Flask Webアプリケーション                     │
│                 (app_enhanced.py)                        │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ Perfect Order│  │ Bollinger    │  │ 52Week       │  │
│  │ Screener     │  │ Band Screener│  │ Pullback     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│              スクリーニングエンジン                        │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐  │
│  │  pullback_screener.py (統合エンジン)              │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ week52_high  │  │ ema_touch    │  │ stochastic   │  │
│  │ _detector.py │  │ _detector.py │  │ _detector.py │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                   データレイヤー                          │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────┐        ┌────────────────────┐    │
│  │  Supabase DB     │        │  Local JSON        │    │
│  │  (クラウド)       │        │  (バックアップ)     │    │
│  └──────────────────┘        └────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### ディレクトリ構造

```
stock_screener_enhanced/
├── app_enhanced.py                    # Webアプリケーション
├── daily_data_collection.py           # 日次データ収集
├── week52_high_detector.py            # 52週新高値検出
├── ema_touch_detector.py              # EMAタッチ判定
├── stochastic_detector.py             # ストキャスティクス計算
├── pullback_screener.py               # 統合スクリーナー
├── templates/
│   └── index_enhanced.html            # UIテンプレート
├── static/                            # 静的ファイル
├── data/
│   └── screening_history.json         # 履歴データ
├── logs/
│   └── daily_collection_20251018.log  # 実行ログ
├── supabase_schema.sql                # DBスキーマ
├── fix_rls_policies.sql               # RLSポリシー
└── ドキュメント各種
```

---

## 🚀 使用方法

### Webアプリケーション

**アクセス**:
```
https://5000-itvw29tdrpzjiu2zgj2pg-79c9481d.manusvm.computer
```

**操作手順**:
1. 画面上部のタブで手法を選択
   - パーフェクトオーダー
   - ボリンジャーバンド
   - 52週新高値押し目
2. フィルター条件を設定
   - 市場選択（全市場/プライム/スタンダード/グロース）
   - EMAタッチ（52週新高値押し目のみ）
   - ストキャスティクス（52週新高値押し目のみ）
3. 「スクリーニング実行」ボタンをクリック
4. 検出結果が表形式で表示される

### 日次データ収集

**手動実行**:
```bash
cd /home/ubuntu/stock_screener_enhanced
python3 daily_data_collection.py
```

**自動実行（cron設定）**:
```bash
# 東証終了後の15:30に自動実行
30 15 * * 1-5 cd /home/ubuntu/stock_screener_enhanced && python3 daily_data_collection.py
```

### ローカル起動

```bash
cd /home/ubuntu/stock_screener_enhanced
python3 app_enhanced.py
```

アプリケーションは `http://localhost:5000` で起動します。

---

## 🎯 スクリーニング手法の詳細

### 1. パーフェクトオーダー

**条件**:
- 株価 ≥ 10EMA ≥ 20EMA ≥ 50EMA

**意味**:
- 短期・中期・長期のトレンドがすべて上向き
- 強い上昇トレンドの銘柄を検出

**表示項目**:
- 銘柄コード、銘柄名、市場
- 株価、10EMA、20EMA、50EMA
- 出来高

### 2. ボリンジャーバンド±3σ

**条件**:
- 株価 ≥ 上限3σ（買われすぎ）
- 株価 ≤ 下限3σ（売られすぎ）

**意味**:
- 統計的に異常な価格水準に達した銘柄
- 反転の可能性がある銘柄を検出

**表示項目**:
- 銘柄コード、銘柄名、市場
- 株価、SMA20、上限3σ、下限3σ
- シグナル（買われすぎ/売られすぎ）

### 3. 52週新高値押し目

**条件**:
- 直近20営業日以内に52週新高値を達成
- EMA（10/20/50）にタッチ
- オプション: ストキャスティクス売られすぎ（%K ≤ 20）

**意味**:
- 強いトレンド中の押し目買いチャンス
- 新高値後の調整局面を捉える

**表示項目**:
- 銘柄コード、銘柄名、市場
- 株価、52週高値、押し目率
- タッチEMA、高値達成日

---

## 📈 技術スタック

### フロントエンド
- **HTML5/CSS3**: レスポンシブデザイン
- **JavaScript**: 非同期通信、動的UI更新
- **グラデーション**: モダンなビジュアルデザイン

### バックエンド
- **Python 3.11**: メイン言語
- **Flask**: Webフレームワーク
- **Pandas**: データ処理
- **NumPy**: 数値計算

### データベース
- **Supabase**: クラウドPostgreSQL
- **JSON**: ローカルバックアップ

### デプロイ
- **Flask開発サーバー**: ポート5000
- **公開プロキシ**: Manusプラットフォーム

---

## ✅ 動作確認

### Webアプリケーション
- [x] Flask起動成功
- [x] ダミーデータ生成（15銘柄×300日 = 4,500レコード）
- [x] 公開URL生成成功
- [x] APIエンドポイント動作確認
- [x] UI表示確認

### スクリーニングエンジン
- [x] パーフェクトオーダー検出
- [x] ボリンジャーバンド検出
- [x] 52週新高値押し目検出
- [x] 市場フィルター動作
- [x] EMAフィルター動作
- [x] ストキャスティクスフィルター動作

### データベース連携
- [x] Supabase接続成功
- [x] screening_resultsテーブル保存
- [x] detected_stocksテーブル保存
- [x] ローカルJSON保存

---

## 🔧 環境変数

### 設定済み環境変数

```bash
# Supabase設定
export SUPABASE_URL="https://asdvlrcwkbmwbosecoti.supabase.co"
export SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# jQuants設定（未設定 = ダミーデータモード）
# export JQUANTS_REFRESH_TOKEN="your_token"
```

これらは `.bashrc` に保存されており、次回セッションでも自動読み込みされます。

---

## 📦 バックアップ

### アーカイブファイル

**最新版**:
- `stock_screener_complete_20251018_0818.tar.gz` (39KB)
- 場所: `/home/ubuntu/`
- 内容: 完全版のすべてのファイル

**復元方法**:
```bash
cd /home/ubuntu
tar -xzf stock_screener_complete_20251018_0818.tar.gz
```

---

## 🎯 今後の拡張可能性

### 1. 実データ連携
- jQuants APIキー設定
- リアルタイム株価データ取得
- 全市場銘柄のスクリーニング

### 2. 機能追加
- チャート表示機能
- アラート通知機能
- バックテスト機能
- ポートフォリオ管理

### 3. パフォーマンス改善
- データベースインデックス最適化
- キャッシング機能
- 並列処理

### 4. UI/UX改善
- ダークモード
- カスタマイズ可能なダッシュボード
- エクスポート機能（CSV/Excel）

---

## 📝 注意事項

### 現在の制限
1. **ダミーデータモード**: jQuants APIキー未設定のため、ダミーデータで動作
2. **開発サーバー**: Flask開発サーバーを使用（本番環境ではWSGIサーバー推奨）
3. **サンプル銘柄**: 15銘柄のみでテスト

### 推奨設定（実運用時）
1. jQuants APIキーの設定
2. WSGIサーバー（Gunicorn等）の使用
3. Nginx等のリバースプロキシ設定
4. SSL/TLS証明書の設定
5. エラー監視・ログ管理

---

## 🎉 まとめ

株式スクリーニングWebアプリケーションが完全に動作する状態で完成しました。

**完成した機能**:
✅ 3つのスクリーニング手法を統合したWebアプリ  
✅ レスポンシブでモダンなUI  
✅ リアルタイム検索機能  
✅ Supabaseデータベース連携  
✅ 日次データ収集の自動化  
✅ 二重保存によるデータ安全性  
✅ 公開URLでアクセス可能  

このシステムは、投資判断をサポートする強力なツールとして機能します。実データ連携を行えば、実際の市場分析に活用できます。

---

**公開URL**: https://5000-itvw29tdrpzjiu2zgj2pg-79c9481d.manusvm.computer

**アーカイブ**: `stock_screener_complete_20251018_0818.tar.gz`

**作成日**: 2025年10月18日  
**作成者**: Manus AI Agent  
**バージョン**: 3.0.0 (完全統合版)

