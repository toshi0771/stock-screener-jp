# 📋 GitHub Actions ワークフロー分割実行 報告書

GitHub Actionsの無料プランにおける「1ジョブ最大6時間」の制限を回避し、J-Quants APIのレート制限を守りながら全銘柄のスクリーニングを完遂するための修正内容を報告します。

---

## 1. 修正の背景と目的

- **課題**: 全4種類のスクリーニングを連続実行すると約8.8時間かかり、GitHub Actionsの無料枠上限（6時間）を超えて強制終了される。
- **目的**: 処理を分割し、各ジョブを6時間以内に収めることで、追加コストなしで全銘柄のデータを毎日確実に更新する。

---

## 2. 新しい実行スケジュール（日本時間）

各スクリーニングを1時間ずつずらして開始するように設定しました。

| ワークフロー名 | 開始時刻 | 推定終了時刻 | 実行スクリプト |
| :--- | :--- | :--- | :--- |
| **Perfect Order** | **16:00** | 18:15頃 | `run_perfect_order.py` |
| **Bollinger Band** | **17:00** | 19:15頃 | `run_bollinger_band.py` |
| **200-Day Pullback** | **18:00** | 20:15頃 | `run_200day_pullback.py` |
| **Squeeze** | **19:00** | 21:15頃 | `run_squeeze.py` |

---

## 3. 技術的な修正内容

### ① 実行スクリプトの個別化
`daily_data_collection.py` の機能を継承しつつ、特定の手法のみを呼び出す4つの軽量なラッパースクリプトを作成しました。これにより、既存のロジックを壊すことなく、単一手法の実行が可能になりました。

### ② ワークフローファイルの分割
`.github/workflows/` 内に4つの独立したYAMLファイルを作成しました。
- `screening-perfect-order.yml`
- `screening-bollinger-band.yml`
- `screening-200day-pullback.yml`
- `screening-squeeze.yml`

### ③ レート制限の厳格化
各スクリプト内でのAPIコール直後に `asyncio.sleep(1.1)` を確実に実行し、並列処理を排除して順次処理（`for`ループ）に書き換えることで、429エラー（Too Many Requests）を完全に防止しています。

---

## 4. 運用上のメリット

1. **安定性の向上**: 1つのスクリーニングがエラーで止まっても、他の3つには影響しません。
2. **ログの視認性**: GitHubのActionsタブで、各手法ごとの実行ログを個別に確認・管理できます。
3. **コスト最適化**: 有料プランへのアップグレードなしで、現在のLightプランのまま全銘柄の運用が可能です。

---

## 5. 今後の確認事項

- **実行状況の確認**: 最初の平日16:00以降に、GitHubの「Actions」タブで各ジョブが緑色のチェックマーク（Success）で完了しているかご確認ください。
- **データの反映**: すべての処理が終わる21:30頃には、Webサイト上で最新の全データが閲覧可能になります。

---
**作成日**: 2026年1月15日
**ステータス**: 修正完了・デプロイ済み
