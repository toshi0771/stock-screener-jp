# 日次株式スクリーニングデータ収集システム - 実行結果レポート

**実行日時**: 2025年10月19日 05:23  
**バージョン**: 2.0.0 (実データ版)  
**ステータス**: ✅ 正常完了

---

## 実行サマリー

### 処理対象
- **総銘柄数**: 3,793銘柄
  - プライム市場: 1,616銘柄
  - スタンダード市場: 1,569銘柄
  - グロース市場: 608銘柄
- **サンプリング数**: 90銘柄 (各市場30銘柄ずつ)

### 検出結果

#### 1. パーフェクトオーダー
**条件**: 株価 ≥ 10EMA ≥ 20EMA ≥ 50EMA

**検出数**: 3銘柄

| 銘柄コード | 銘柄名 | 市場 | 株価 | 10EMA | 20EMA | 50EMA | 出来高 |
|-----------|--------|------|------|-------|-------|-------|--------|
| 96720 | 東京都競馬 | プライム | 5,620円 | 5,534円 | 5,457円 | 5,296円 | 56,800 |
| 69610 | エンプラス | プライム | 6,120円 | 6,025円 | 5,885円 | 5,501円 | 55,300 |
| 25400 | 養命酒製造 | プライム | 4,195円 | 4,075円 | 4,023円 | 3,874円 | 39,700 |

**処理時間**: 20.9秒

#### 2. ボリンジャーバンド±3σ
**条件**: 株価がボリンジャーバンドの±3σに到達

**検出数**: 0銘柄

**処理時間**: 21.0秒

#### 3. 52週新高値押し目
**条件**: 52週新高値から10%以内の押し目で、いずれかのEMAにタッチ

**検出数**: 0銘柄

**処理時間**: 21.9秒

---

## システム性能

### 実行時間
- **総実行時間**: 約66秒
- **1銘柄あたりの処理時間**: 約0.73秒
- **API呼び出し回数**: 90回 (株価データ取得)

### データ保存
- ✅ Supabaseデータベース: 正常保存
- ✅ ローカルJSON履歴: 正常保存
- ✅ 実行ログ: 正常記録

---

## 技術仕様

### API連携
- **jQuants API**: 正常認証・データ取得成功
- **Supabase API**: 正常接続・データ保存成功

### データ処理
- **株価データ取得期間**: 過去260営業日 (約1年分)
- **EMA計算**: 10期間、20期間、50期間
- **ボリンジャーバンド**: 20期間、±3σ
- **52週高値**: 過去260営業日の最高値

### スクリーニングロジック

#### パーフェクトオーダー
```python
条件: 株価 >= 10EMA >= 20EMA >= 50EMA
```

#### ボリンジャーバンド±3σ
```python
上限: SMA20 + (STD20 × 3)
下限: SMA20 - (STD20 × 3)
条件: 株価 >= 上限 または 株価 <= 下限
```

#### 52週新高値押し目
```python
52週高値: 過去260営業日の最高値
下落率: (52週高値 - 現在価格) / 52週高値 × 100
EMAタッチ判定: |現在価格 - EMA| / EMA <= 2%
条件: 下落率 <= 10% かつ いずれかのEMAにタッチ
```

---

## 履歴統計

### 過去2日間の平均検出数
- **パーフェクトオーダー**: 5.5銘柄/日
- **ボリンジャーバンド**: 1.0銘柄/日
- **52週新高値押し目**: 1.0銘柄/日

### データ保持期間
- **過去90日分の履歴を自動管理**
- 90日以前のデータは自動削除

---

## ファイル構成

```
stock_screener_enhanced/
├── daily_data_collection.py          # メインスクリプト (実データ版)
├── daily_data_collection_old.py      # 旧スクリプト (ダミーデータ版)
├── data/
│   └── screening_history.json        # 履歴データ (過去90日分)
├── logs/
│   └── daily_collection_20251019.log # 実行ログ
├── .env.backup                        # 環境変数バックアップ
└── 実行結果レポート_20251019.md      # このファイル
```

---

## 環境変数

### 必要な環境変数
```bash
# jQuants API
JQUANTS_REFRESH_TOKEN="eyJjdHkiOiJKV1QiLCJlbmMi..."

# Supabase
SUPABASE_URL="https://asdvlrcwkbmwbosecoti.supabase.co"
SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6..."
```

---

## 使用方法

### 手動実行
```bash
cd /home/ubuntu/stock_screener_enhanced
source /home/ubuntu/.env
python3 daily_data_collection.py
```

### Cron設定 (東証終了後の15:30に自動実行)
```bash
30 15 * * 1-5 cd /home/ubuntu/stock_screener_enhanced && source /home/ubuntu/.env && python3 daily_data_collection.py
```

---

## 今後の改善点

### 機能拡張
1. **サンプリング数の調整**: 現在30銘柄/市場 → 全銘柄対応
2. **並列処理**: 複数銘柄の同時処理で高速化
3. **キャッシュ機能**: 既取得データの再利用
4. **アラート機能**: 条件達成時の通知

### パフォーマンス最適化
1. **API呼び出しの最適化**: バッチ取得の活用
2. **データベースインデックス**: クエリ速度の向上
3. **非同期処理**: asyncio/aiohttp の活用

---

## トラブルシューティング

### jQuants API認証エラー
```bash
# リフレッシュトークンの再取得
python3 << EOF
import requests, json
data = {"mailaddress": "your_email", "password": "your_password"}
r = requests.post("https://api.jquants.com/v1/token/auth_user", data=json.dumps(data))
print(r.json()["refreshToken"])
EOF
```

### Supabase接続エラー
```bash
# 環境変数の確認
echo $SUPABASE_URL
echo $SUPABASE_ANON_KEY
```

### ログの確認
```bash
tail -f /home/ubuntu/stock_screener_enhanced/logs/daily_collection_$(date +%Y%m%d).log
```

---

## 成功指標

### 技術的成功
- ✅ 実データでのスクリーニング動作確認
- ✅ jQuants API連携成功
- ✅ Supabaseデータベース保存成功
- ✅ ローカルJSON履歴管理成功
- ✅ エラーハンドリング実装

### ビジネス的成功
- ✅ パーフェクトオーダー銘柄の検出
- ✅ 過去データとの統計比較
- ✅ 自動化可能な構造
- ✅ 拡張可能な設計

---

## 結論

日次株式スクリーニングデータ収集システムの実データ版が正常に動作することを確認しました。jQuants APIから実際の株価データを取得し、3つのスクリーニング手法で銘柄を検出し、Supabaseとローカルファイルの両方にデータを保存できています。

今後はサンプリング数の拡大、並列処理による高速化、アラート機能の追加などを進めることで、より実用的なシステムに発展させることができます。

---

**作成日**: 2025年10月19日  
**作成者**: Manus AI Agent  
**バージョン**: 2.0.0

