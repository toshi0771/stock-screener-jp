# J-Quants API V2対応版 - 休日データ保存防止機能付き

## 📋 このバージョンについて

このバージョンは、以下の機能を含む修正版です：

1. ✅ **J-Quants API V2対応**
   - APIキー認証に対応
   - 新エンドポイント対応（/v2/equities/master, /v2/equities/bars/daily）
   - レスポンス構造の自動変換
   - V1 API互換性の維持（フォールバック機能）

2. ✅ **休日データ保存防止機能**
   - 取引カレンダーAPIで営業日をチェック
   - 休場日にはスクリーニングをスキップ
   - データの整合性を向上

## 🔧 主な変更ファイル

- `daily_data_collection.py`: V2 API対応と営業日チェック機能を追加

## 🚀 使用方法

### 1. 環境変数の設定

Renderの環境変数に以下を設定してください：

```
JQUANTS_API_KEY=your_api_key_here
```

### 2. デプロイ

GitHubにプッシュすると、Renderが自動的にデプロイします。

### 3. 動作確認

ログで以下のメッセージを確認してください：

```
✅ J-Quants API V2を使用します（APIキー認証）
📅 実行日: 2026-01-03
🔍 営業日チェック中...
✅ 2026-01-03 は営業日です
✅ 本日は営業日です。スクリーニングを開始します
```

## 📚 詳細ドキュメント

詳細な移行手順とトラブルシューティングについては、以下のドキュメントを参照してください：

- `jquants_v2_migration_guide.md`: V2 API移行手順書
- `jquants_v2_migration_complete.md`: 移行完了レポート

## 🎯 V2 API移行のメリット

- ✅ リフレッシュトークンの手動更新（7日ごと）が不要
- ✅ APIキーは期限なしで永続的に利用可能
- ✅ 休場日のデータが保存されない
- ✅ データの整合性が向上

## 📅 作成日

2026-01-03

## 📝 変更履歴

- 2026-01-03: V2 API対応と営業日チェック機能を追加
